
-- WITH agg AS (
--     SELECT `val` AS myval, intDiv(`time_min`,5)*5 AS bucket FROM histogram_test_table
-- )
-- SELECT AVG(agg.myval),agg.bucket FROM agg GROUP BY agg.bucket ORDER BY bucket;


-- With time_min AS UInt32

-- WITH agg AS (
--     SELECT `value` AS myval, intDiv(time_min,300)*300 AS bucket FROM histogram_test_table_2
-- )
-- SELECT AVG(agg.myval),agg.bucket FROM agg GROUP BY agg.bucket ORDER BY bucket;



-- New Query
select intDiv(time_min,300)*300 FROM histogram_test_table

-- Original Query
select toUnixTimestamp(toStartOfInterval(toDateTime(time_min,'UTC'),INTERVAL 5 MINUTE)) from histogram_test_table






    CREATE TABLE histogram_test_table_2
(
    value Int32,
    time_min DateTime64
) ENGINE = MergeTree()
ORDER BY time_min;


INSERT INTO histogram_test_table_2 (value, time_min) VALUES
                                                       (45, '2025-03-17 00:00:00'), (52, '2025-03-17 00:01:00'), (48, '2025-03-17 00:02:00'), (60, '2025-03-17 00:03:00'), (55, '2025-03-17 00:04:00'),
                                                       (43, '2025-03-17 00:05:00'), (50, '2025-03-17 00:06:00'), (62, '2025-03-17 00:07:00'), (39, '2025-03-17 00:08:00'), (58, '2025-03-17 00:09:00'),
                                                       (47, '2025-03-17 00:10:00'), (49, '2025-03-17 00:11:00'), (65, '2025-03-17 00:12:00'), (54, '2025-03-17 00:13:00'), (42, '2025-03-17 00:14:00'),
                                                       (59, '2025-03-17 00:15:00'), (61, '2025-03-17 00:16:00'), (57, '2025-03-17 00:17:00'), (46, '2025-03-17 00:18:00'), (53, '2025-03-17 00:19:00'),
                                                       (63, '2025-03-17 00:20:00'), (38, '2025-03-17 00:21:00'), (50, '2025-03-17 00:22:00'), (44, '2025-03-17 00:23:00'), (68, '2025-03-17 00:24:00'),
                                                       (56, '2025-03-17 00:25:00'), (41, '2025-03-17 00:26:00'), (64, '2025-03-17 00:27:00'), (55, '2025-03-17 00:28:00'), (60, '2025-03-17 00:29:00'),
                                                       (52, '2025-03-17 00:30:00'), (49, '2025-03-17 00:31:00'), (66, '2025-03-17 00:32:00'), (45, '2025-03-17 00:33:00'), (40, '2025-03-17 00:34:00'),
                                                       (58, '2025-03-17 00:35:00'), (62, '2025-03-17 00:36:00'), (51, '2025-03-17 00:37:00'), (47, '2025-03-17 00:38:00'), (65, '2025-03-17 00:39:00'),
                                                       (53, '2025-03-17 00:40:00'), (57, '2025-03-17 00:41:00'), (60, '2025-03-17 00:42:00'), (38, '2025-03-17 00:43:00'), (42, '2025-03-17 00:44:00'),
                                                       (55, '2025-03-17 00:45:00'), (67, '2025-03-17 00:46:00'), (59, '2025-03-17 00:47:00'), (50, '2025-03-17 00:48:00'), (44, '2025-03-17 00:49:00'),
                                                       (63, '2025-03-17 00:50:00'), (52, '2025-03-17 00:51:00'), (41, '2025-03-17 00:52:00'), (61, '2025-03-17 00:53:00'), (56, '2025-03-17 00:54:00'),
                                                       (45, '2025-03-17 00:55:00'), (60, '2025-03-17 00:56:00'), (53, '2025-03-17 00:57:00'), (66, '2025-03-17 00:58:00'), (49, '2025-03-17 00:59:00');